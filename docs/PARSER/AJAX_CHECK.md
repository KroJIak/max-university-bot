# Как проверить AJAX запросы на странице

## Что такое AJAX?

**AJAX** (Asynchronous JavaScript and XML) - это технология, которая позволяет веб-странице загружать данные с сервера **без перезагрузки страницы**.

### Как это работает:

1. Пользователь открывает страницу
2. Страница загружается (HTML загружен, но данные могут быть пустыми)
3. JavaScript на странице выполняет AJAX запрос к серверу
4. Сервер возвращает данные (обычно в формате JSON)
5. JavaScript заполняет поля на странице этими данными

### Почему это проблема для скрапинга?

Когда мы используем `requests` для получения HTML страницы, мы получаем только **исходный HTML**, но не выполняем JavaScript. Поэтому:
- Если данные загружаются через AJAX, они **не будут** в исходном HTML
- Поля будут пустыми в HTML, но заполненными в браузере

## Как проверить, используются ли AJAX запросы?

### Способ 1: Использование Developer Tools в браузере

1. **Откройте страницу** `https://lk.chuvsu.ru/student/personal_data.php` в браузере
2. **Откройте Developer Tools**: нажмите `F12` или `Ctrl+Shift+I` (Windows/Linux) / `Cmd+Option+I` (Mac)
3. **Перейдите на вкладку "Network"** (Сеть)
4. **Очистите список запросов**: нажмите кнопку "Clear" (Очистить)
5. **Обновите страницу**: нажмите `F5`
6. **Отфильтруйте запросы**:
   - Нажмите на фильтр "XHR" или "Fetch" - это AJAX запросы
   - Или найдите запросы с типом `xhr` или `fetch`

### Что искать:

1. **Запросы после загрузки страницы**: если вы видите запросы, которые выполняются **после** загрузки HTML, это может быть AJAX
2. **Запросы к API endpoints**: ищите запросы к URL, которые содержат:
   - `api`
   - `data.php`
   - `get_data.php`
   - `personal_data.php` (если это не сама страница)
   - Другие `.php` файлы
3. **Ответы в формате JSON**: откройте запрос и проверьте вкладку "Response" (Ответ) - если там JSON с данными студента, это то, что нужно!

### Пример того, что вы можете увидеть:

```
Request URL: https://lk.chuvsu.ru/student/get_personal_data.php
Request Method: POST
Status Code: 200 OK
Response: {
  "surname": "Иванов",
  "name": "Иван",
  "patronymic": "Иванович",
  ...
}
```

### Что делать, если нашли AJAX запрос:

1. **Скопируйте URL** запроса
2. **Скопируйте параметры** запроса (Headers, Payload)
3. **Добавьте этот запрос в scraper** - вместо парсинга HTML, делайте прямой запрос к этому endpoint

## Способ 2: Проверка исходного кода страницы

1. Откройте страницу в браузере
2. Нажмите `Ctrl+U` (Просмотр исходного кода)
3. Нажмите `Ctrl+F` (Поиск)
4. Ищите:
   - `ajax`
   - `fetch`
   - `XMLHttpRequest`
   - `$.get` или `$.post` (jQuery)
   - `axios`

Если найдете эти слова в JavaScript коде, значит страница использует AJAX.

## Способ 3: Использование скрипта check_ajax.py

Запустите скрипт для автоматической проверки:

```bash
python3 scripts/check_ajax.py
```

Скрипт:
- Загрузит HTML страницы
- Найдет все JavaScript код
- Найдет потенциальные AJAX запросы
- Покажет все input поля на странице
- Сохранит HTML для анализа

## Решение проблемы

### Если данные загружаются через AJAX:

1. **Найдите endpoint**, который возвращает данные
2. **Сделайте прямой запрос** к этому endpoint с теми же cookies
3. **Получите данные в формате JSON** вместо парсинга HTML

Пример:

```python
# Вместо парсинга HTML:
response = session.get('https://lk.chuvsu.ru/student/personal_data.php')

# Делайте прямой запрос к AJAX endpoint:
response = session.post('https://lk.chuvsu.ru/student/get_personal_data.php', 
                       json={'student_id': '...'})
data = response.json()  # Получаете данные сразу в JSON
```

### Если данные в исходном HTML, но пустые:

1. **Проверьте cookies**: возможно, нужны другие cookies
2. **Проверьте заголовки**: возможно, нужны специальные заголовки
3. **Проверьте параметры запроса**: возможно, нужны POST параметры

## Текущая ситуация

Сейчас scraper находит только `photo_url`, потому что:
- Либо данные загружаются через AJAX (и их нет в исходном HTML)
- Либо данные в HTML, но в другом формате (не в атрибуте `value`)

**Что нужно сделать:**
1. Откройте страницу в браузере с Developer Tools
2. Проверьте Network вкладку на наличие AJAX запросов
3. Если найдете запрос с данными - используйте его URL в scraper
4. Если не найдете - проверьте сохраненный HTML файл (`/tmp/personal_data_debug.html`)

