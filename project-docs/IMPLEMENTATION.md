# –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

–ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã Max University Bot.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è)
- [Web Scraping](#web-scraping)
- [Multi-tenancy](#multi-tenancy)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è endpoints](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-endpoints)
- [Fallback –ª–æ–≥–∏–∫–∞](#fallback-–ª–æ–≥–∏–∫–∞)

## üîÑ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è

MAX API –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ University API –∏–ª–∏ Ghost API –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

### –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ API

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
   - –ï—Å–ª–∏ endpoint –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ –ë–î ‚Üí –∑–∞–ø—Ä–æ—Å –∫ **University API**
   - –ï—Å–ª–∏ endpoint –ø—É—Å—Ç–æ–π ‚Üí –∑–∞–ø—Ä–æ—Å –∫ **Ghost API**

2. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ URL:**
   - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: `base_url` –∏–∑ –ë–î (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏)
   - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: `http://UNIVERSITY_API_HOST:UNIVERSITY_API_PORT`

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
   - –ï—Å–ª–∏ University API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ Ghost API
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### –ü—Ä–∏–º–µ—Ä –ø–æ—Ç–æ–∫–∞

```
Bot ‚Üí MAX API ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
                    ‚îú‚îÄ Endpoint –Ω–∞—Å—Ç—Ä–æ–µ–Ω ‚Üí University API
                    ‚îî‚îÄ Endpoint –ø—É—Å—Ç–æ–π ‚Üí Ghost API
```

---

## üï∑Ô∏è Web Scraping

University API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç web scraping –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å —Å–∞–π—Ç–∞ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞.

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏

- **Cookies —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞
- **–°–µ—Å—Å–∏–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è** –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ª–æ–≥–∏–Ω–µ
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–∫—Ä–∞–ø–µ—Ä–∞

```
university-app/services/
‚îú‚îÄ‚îÄ base.py          # –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å —Å session management
‚îú‚îÄ‚îÄ auth.py          # –õ–æ–≥–∏–Ω —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
‚îú‚îÄ‚îÄ schedule.py      # –ü–∞—Ä—Å–∏–Ω–≥ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
‚îú‚îÄ‚îÄ teachers.py      # –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π
‚îú‚îÄ‚îÄ contacts.py      # –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
‚îú‚îÄ‚îÄ personal_data.py # –õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îî‚îÄ‚îÄ utils.py         # –£—Ç–∏–ª–∏—Ç—ã (–ø–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç –∏ —Ç.–¥.)
```

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞

- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ ID:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–∏—Å–∫ –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º (`id.endswith('-1')`)
- **AJAX –∑–∞–ø—Ä–æ—Å—ã:** –≠–º—É–ª—è—Ü–∏—è –±—Ä–∞—É–∑–µ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** Graceful degradation –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–∞–π—Ç–∞

---

## üè¢ Multi-tenancy

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–∑–æ–ª—è—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –ø–æ `university_id`.

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

1. **–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è** –ø–æ `university_id`
2. **JWT —Ç–æ–∫–µ–Ω—ã** —Å–æ–¥–µ—Ä–∂–∞—Ç `university_id`
3. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** —Ö—Ä–∞–Ω–∏—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞

### –¢–∞–±–ª–∏—Ü—ã —Å multi-tenancy

- `universities` - —Å–ø–∏—Å–æ–∫ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤
- `users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ `university_id`
- `university_config` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞
- `student_credentials` - —Å—Ç—É–¥–µ–Ω—Ç—ã –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è endpoints

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è endpoints —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ë–î –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å.

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```json
{
  "base_url": "https://university-api.example.com",
  "endpoints": {
    "students_login": "/students/login",
    "students_schedule": "/students/schedule",
    "students_teachers": "/students/teachers",
    // ... –¥—Ä—É–≥–∏–µ endpoints
  },
  "enabled_features": {
    "students_login": true,
    "students_schedule": true,
    // ... –¥—Ä—É–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
  }
}
```

### –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ endpoints

–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –º–æ–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å endpoints —á–µ—Ä–µ–∑ OpenAPI —Å—Ö–µ–º—É University API.

### –í–∞–ª–∏–¥–∞—Ü–∏—è

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ `base_url`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è endpoints
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ç–≤–µ—Ç–æ–≤

---

## üîÑ Fallback –ª–æ–≥–∏–∫–∞

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—É—é fallback –ª–æ–≥–∏–∫—É –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏.

### –£—Ä–æ–≤–Ω–∏ fallback

1. **–î–æ–º–µ–Ω–Ω—ã–π URL ‚Üí HOST:PORT**
   - –ï—Å–ª–∏ `DOMAIN_URL` —É–∫–∞–∑–∞–Ω, –Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `http://HOST:PORT`

2. **University API ‚Üí Ghost API**
   - –ï—Å–ª–∏ endpoint –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –Ω–æ University API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí –∑–∞–ø—Ä–æ—Å –∫ Ghost API
   - –ï—Å–ª–∏ endpoint –ø—É—Å—Ç–æ–π ‚Üí —Å—Ä–∞–∑—É –∑–∞–ø—Ä–æ—Å –∫ Ghost API

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
   - –í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ

### –ü—Ä–∏–º–µ—Ä—ã

**–ü—Ä–∏–º–µ—Ä 1: –î–æ–º–µ–Ω–Ω—ã–π URL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω**
```
MAX_API_DOMAIN_URL=https://api.example.com (–Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
‚Üí Fallback: http://0.0.0.0:8003
```

**–ü—Ä–∏–º–µ—Ä 2: University API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω**
```
Endpoint –Ω–∞—Å—Ç—Ä–æ–µ–Ω: /students/schedule
University API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
‚Üí Fallback: Ghost API
```

---

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

### JWT —Ç–æ–∫–µ–Ω—ã

- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞—â–∏—â–µ–Ω–Ω—ã–º endpoints
- –°–æ–¥–µ—Ä–∂–∞—Ç `university_id` –¥–ª—è multi-tenancy
- –í—Ä–µ–º—è –∂–∏–∑–Ω–∏: –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è

### –ü–æ—Ç–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

1. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ª–æ–≥–∏–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
2. MAX API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT —Ç–æ–∫–µ–Ω
3. –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–∫–µ–Ω
4. –í—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–æ–∫–µ–Ω

---

## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ö–µ–º–∞ –ë–î

**maxbot_db:**
- `universities` - —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã
- `users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ MAX
- `student_credentials` - —Å–≤—è–∑—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
- `university_config` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è endpoints

**university_db:**
- `session_cookies` - cookies —Å–µ—Å—Å–∏–π —Å—Ç—É–¥–µ–Ω—Ç–æ–≤

**ghost_db:**
- `teachers` - –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏
- `schedule` - —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
- `news` - –Ω–æ–≤–æ—Å—Ç–∏
- `maps` - –∫–∞—Ä—Ç—ã
- `contacts` - –∫–æ–Ω—Ç–∞–∫—Ç—ã

### –ú–∏–≥—Ä–∞—Ü–∏–∏

SQL –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `migrations/` –∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –≤—Ä—É—á–Ω—É—é.

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ—Å—Ç—É–ø–µ–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç:
- **Email:** `test@test.ru`
- **–ü–∞—Ä–æ–ª—å:** `test`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å—Ç—É–¥–µ–Ω—Ç–∞ –ß–ì–£
- –ù–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É `user_id`

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç `scripts/test_api.py` –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è endpoints.

---

## üîç –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã

### MAX API
- `app/api/v1/proxy.py` - –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- `app/api/v1/config.py` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
- `app/core/url_helper.py` - —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å URL

### University API
- `university-app/services/university_scraper.py` - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∞–ø–µ—Ä
- `university-app/api/students.py` - endpoints

### Ghost API
- `ghost-app/api/upload.py` - –∑–∞–≥—Ä—É–∑–∫–∞ CSV
- `ghost-app/services/csv_parser.py` - –ø–∞—Ä—Å–∏–Ω–≥ CSV
